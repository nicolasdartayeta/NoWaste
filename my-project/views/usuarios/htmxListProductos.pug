include ../scripts/filter.pug

div(class='flex flex-col items-center justify-center p-4 w-full')
    form(class='max-w-sm mx-auto')
        label(for='tipoProducto' class='block mb-2 text-sm font-medium text-gray-900 dark:text-white') Tipo de producto
        select(onchange=`filterItems(this.value)` class='bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500')
            option(selected='all' value='all') Todos
            each tipo in tiposProductos
                option(value=tipo) #{tipo}

    p(class='text-2xl font-bold leading-9 tracking-tight bg-gradient-to-t from-lime-700 to-green-900 bg-clip-text text-transparent') Productos
    
    if productos.length 
        div(class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4")      
                each producto in productos
                    if producto.stock > 0
                        div(class='filterable-item')    
                            ul
                                p Local: #{producto.restauranteNombre}
                                p Nombre: #{producto.nombre}
                                p Descripción: #{producto.descripcion}
                                p(class='tipoProducto') Tipo: #{producto.tipoProducto}
                                p Precio: #{producto.precio}
                                P Stock: #{producto.stock}
                                section(class="container")
                                    div.slider-wrapper
                                        - let counter = 0
                                        div.slider-nav
                                            each imagen in producto.imagenesProducto
                                                a(href = '#img_'+ imagen.id +(counter++))
                                        - counter = 0
                                        div.slider
                                            each imagen in producto.imagenesProducto
                                                img(id='img_'+ imagen.id+(counter++) src='/static/images/'+imagen.id onerror="this.remove()")

                                if (producto.stock > 0)
                                    form(action=`/user/compra/${producto._id}`, method="POST")
                                        label(for=`cantidad-${producto._id}`) Cantidad:
                                        input(type="number", id=`cantidad-${producto._id}`, name=`cantidad`, min="1", max=producto.stock, value="1")
                                        button(onclick=`log(${producto.stock})` type="submit" class="w-full block rounded-lg px-4 py-2 text-sm text-center font-medium bg-green-900/30 hover:bg-green-800/30 hover:text-gray-100") Comprar 
                    else
                        script.
                            async function deleteProduct(restauranteId, productoId) {
                                console.log(restauranteId)
                                try {
                                    const response = await fetch(`/admin/restaurantes/${restauranteId}/deleteProduct/${productoId}`, {
                                        method: 'delete'
                                    });
                                } catch (error) {
                                    console.error(`Error en la solicitud de eliminación: ${error}`);
                                }
                            };
                            deleteProduct(`#{producto.restauranteId}`, `#{producto._id}`)
    else                                
        p No hay productos disponibles